TOP_DIR := $(patsubst %/,%,$(dir $(CURDIR)/$(word $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST))))
SRC_DIR = $(CURDIR)/src
OBJ_DIR = $(CURDIR)/obj
GEN_DIR = $(CURDIR)/generated

NUM_CPUS := $(shell getconf _NPROCESSORS_ONLN)
BUILD_OPTS = -p -j$(NUM_CPUS)

ifeq (,$(NO_CONTRIB))
export ADA_PROJECT_PATH := $(TOP_DIR)/contrib/projects:$(ADA_PROJECT_PATH)
endif

POLICY_DIR = $(TOP_DIR)/policy/obj

MUCFGALLOC    = $(TOP_DIR)/tools/mucfgalloc/bin/mucfgalloc
MUCFGEXPAND   = $(TOP_DIR)/tools/mucfgexpand/bin/mucfgexpand
MUCFGMERGE    = $(TOP_DIR)/tools/mucfgmerge/bin/mucfgmerge
MUCFGVALIDATE = $(TOP_DIR)/tools/mucfgvalidate/bin/mucfgvalidate
MUGENACPI     = $(TOP_DIR)/tools/mugenacpi/bin/mugenacpi
MUGENIOBM     = $(TOP_DIR)/tools/mugeniobm/bin/mugeniobm
MUGENMSRBM    = $(TOP_DIR)/tools/mugenmsrbm/bin/mugenmsrbm
MUGENMSRSTORE = $(TOP_DIR)/tools/mugenmsrstore/bin/mugenmsrstore
MUGENPT       = $(TOP_DIR)/tools/mugenpt/bin/mugenpt
MUGENSINFO    = $(TOP_DIR)/tools/mugensinfo/bin/mugensinfo
MUGENSPEC     = $(TOP_DIR)/tools/mugenspec/bin/mugenspec
MUGENVTD      = $(TOP_DIR)/tools/mugenvtd/bin/mugenvtd
MUGENZP       = $(TOP_DIR)/tools/mugenzp/bin/mugenzp
MUPACK        = $(TOP_DIR)/tools/mupack/bin/mupack
MULNXBZPATCH  = $(TOP_DIR)/tools/mulnxbzpatch/bin/mulnxbzpatch

TO_RAW_OPTS = -O binary --set-section-flags .bss=alloc,load,contents
TO_RAW_CMD  = objcopy $(TO_RAW_OPTS)

HARDWARE ?= bochs
SYSTEM   ?= demo_system
