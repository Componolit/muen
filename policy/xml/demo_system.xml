<?xml version="1.0"?>
<system>
	<platform>
		<processor logicalCpus="4" speed="50" vmxTimerRate="0"/>
		<memory>
			<memoryBlock allocatable="false" name="base_mem" physicalAddress="16#0000#" size="16#000a_0000#" />
			<memoryBlock allocatable="true" name="extended_mem_1" physicalAddress="16#0010_0000#" size="16#8000_0000#" />
		</memory>
		<device name="serial" shared="false">
			<ioPort name="port1" start="16#03f8#" end="16#03ff#"/>
		</device>
		<device name="vga" shared="false">
			<memory name="buffer" physicalAddress="16#000b_8000#" size="16#4000#" caching="WC"/>
			<ioPort name="ports" start="16#03d4#" end="16#03d5#"/>
		</device>
		<device name="keyboard" shared="false">
			<irq name="kbd_irq" number="1"/>
			<ioPort name="port_60" start="16#0060#" end="16#0060#"/>
			<ioPort name="port_64" start="16#0064#" end="16#0064#"/>
		</device>
		<device name="cmos_rtc" shared="false">
			<ioPort name="ports" start="16#0070#" end="16#0071#"/>
		</device>
		<device name="port80" shared="false">
			<ioPort name="ports" start="16#0080#" end="16#0080#"/>
		</device>
		<device name="ioapic" shared="false">
			<memory name="mmio" physicalAddress="16#fec0_0000#" size="16#1000#" caching="UC" />
		</device>
	</platform>

	<memory>
		<memory name="linux|ram" size="16#0f70_0000#" alignment="16#0010_0000#" caching="WB"/>
	</memory>

	<events>
		<event name="linux_keyboard_forward" mode="ipi"/>
		<event name="linux_vt_update" mode="ipi"/>
		<event name="time_vt_update" mode="ipi"/>
		<event name="sm_vt_update" mode="ipi"/>
		<event name="resume_linux" mode="switch"/>
		<event name="trap_to_sm" mode="switch"/>
	</events>

	<channels>
		<channel name="virtual_time" size="16#1000#" hasEvent="false"/>
		<channel name="linux_keyboard" size="16#1000#" hasEvent="false"/>
		<channel name="linux_console" size="16#0001_0000#" hasEvent="false"/>
		<channel name="time_console" size="16#0001_0000#" hasEvent="false"/>
		<channel name="sm_console" size="16#0001_0000#" hasEvent="false"/>
	</channels>

	<subjects>
		<subject name="vt" cpu="0" profile="native">
			<devices>
				<device logical="vga" physical="vga">
					<memory logical="buffer" physical="buffer" virtualAddress="16#000b_8000#" writable="true" executable="false"/>
					<ioPort logical="ports" physical="ports" start="16#03d4#" end="16#03d5#"/>
				</device>
				<device logical="keyboard" physical="keyboard">
					<irq logical="kbd_irq" physical="kbd_irq" number="1" vector="49"/>
					<ioPort logical="port_60" physical="port_60" start="16#0060#" end="16#0060#"/>
					<ioPort logical="port_64" physical="port_64" start="16#0064#" end="16#0064#"/>
				</device>
			</devices>
			<events>
				<source>
					<group name="vmcall">
						<event id="1" logical="forward_keyboard" action="continue">
							<notify physical="linux_keyboard_forward" subject="linux" vector="49" mode="ipi"/>
						</event>
					</group>
				</source>
				<target>
					<event physical="linux_vt_update" logical="update_linux_console" vector="34"/>
					<event physical="time_vt_update" logical="update_time_console" vector="35"/>
					<event physical="sm_vt_update" logical="update_sm_console" vector="36"/>
				</target>
			</events>
			<channels>
				<reader ref="linux_console" virtualAddress="16#0010_0000#"/>
				<reader ref="time_console" virtualAddress="16#0011_0000#"/>
				<reader ref="sm_console" virtualAddress="16#0012_0000#"/>
				<writer ref="linux_keyboard" virtualAddress="16#0005_0000#"/>
			</channels>
			<binary filename="vt" size="16#0002_4000#" virtualAddress="16#1000#"/>
		</subject>

		<subject name="time" cpu="2" profile="native">
			<devices>
				<device logical="port80" physical="port80">
					<ioPort logical="ports" physical="ports" start="16#0080#" end="16#0080#"/>
				</device>
			</devices>
			<events>
				<source>
					<group name="vmcall">
						<event id="1" logical="vt_update" action="continue">
							<notify physical="time_vt_update" subject="vt" vector="35" mode="ipi"/>
						</event>
					</group>
				</source>
			</events>
			<channels>
				<writer ref="virtual_time" virtualAddress="16#0002_0000#"/>
				<writer ref="time_console" virtualAddress="16#000b_8000#"/>
			</channels>
			<binary filename="time" size="16#0001_4000#" virtualAddress="16#1000#"/>
		</subject>

		<subject name="sm" cpu="1" profile="native">
			<events>
				<source>
					<group name="vmcall">
						<event id="1" logical="vt_update" action="continue">
							<notify physical="sm_vt_update" subject="vt" vector="36" mode="ipi"/>
						</event>
						<event id="4" logical="resume_linux" action="continue">
							<notify physical="resume_linux" subject="linux" vector="none" mode="switch"/>
						</event>
					</group>
				</source>
				<target>
					<event physical="trap_to_sm" logical="handle_linux_trap" vector="36"/>
				</target>
			</events>
			<channels>
				<writer ref="sm_console" virtualAddress="16#000b_8000#"/>
			</channels>
			<binary filename="sm" size="16#0001_4000#" virtualAddress="16#1000#"/>
			<monitor>
				<state subject="linux" virtualAddress="16#001e_0000#" writable="true"/>
			</monitor>
		</subject>

		<subject name="linux" cpu="1" profile="linux">
			<bootparams>lpj=10000 earlyprintk=serial console=ttyS0,115200 console=hvc pci=noearly notsc</bootparams>
			<memory>
				<memory logical="ram" physical="linux|ram" virtualAddress="16#0090_0000#" writable="true" executable="true"/>
			</memory>
			<devices>
				<device logical="ttyS0" physical="serial">
					<ioPort logical="port1" physical="port1" start="16#03f8#" end="16#03ff#"/>
				</device>
				<device logical="cmos_rtc" physical="cmos_rtc">
					<ioPort logical="ports" physical="ports" start="16#0070#" end="16#0071#"/>
				</device>
			</devices>
			<events>
				<source>
					<group name="vmx_exit">
						<event id="00" logical="exception" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<!-- external_interrupt : reserved -->
						<event id="02" logical="triple_fault" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="03" logical="init_signal" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="04" logical="sipi" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="05" logical="io_smi" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="06" logical="smi" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<!-- interrupt window : reserved -->
						<event id="08" logical="nmi_window" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="09" logical="task_switch" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="10" logical="cpuid" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="11" logical="getsec" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="12" logical="hlt" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="13" logical="invd" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="14" logical="invlpg" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="15" logical="rdpmc" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="16" logical="rdtsc" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="17" logical="rsm" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="18" logical="unhandled_vmcall" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="19" logical="vmclear" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="20" logical="vmlaunch" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="21" logical="vmptrld" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="22" logical="vmptrst" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="23" logical="vmread" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="24" logical="vmresume" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="25" logical="vmwrite" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="26" logical="vmxoff" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="27" logical="vmxon" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="28" logical="control_register" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="29" logical="debug_register" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="30" logical="io_instruction" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="31" logical="rdmsr" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="32" logical="wrmsr" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="33" logical="failure_guest_state" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="34" logical="failure_msr_loading" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<!-- reserved -->
						<event id="36" logical="mwait" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="37" logical="monitor_trap_flag" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<!-- reserved -->
						<!-- reserved -->
						<event id="39" logical="monitor" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="40" logical="pause" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="41" logical="failure_machine_check" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<!-- reserved -->
						<event id="43" logical="tpr_below_threshold" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="44" logical="apic_access" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="45" logical="virtual_eoi" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="46" logical="gdtr_idtr" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="47" logical="ldtr_tr" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="48" logical="ept_violation" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="49" logical="ept_misconfiguration" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="50" logical="invept" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="51" logical="edtscp" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<!-- vmx_preemption_timer : reserved -->
						<event id="53" logical="invvpid" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="54" logical="wbinvd" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="55" logical="xsetbv" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="56" logical="apic_write" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="57" logical="rdrand" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="58" logical="invpcid" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
						<event id="59" logical="vmfunc" action="continue">
							<notify physical="trap_to_sm" subject="sm" vector="36" mode="switch"/>
						</event>
					</group>
					<group name="vmcall">
						<event id="1" logical="vt_update" action="continue">
							<notify physical="linux_vt_update" subject="vt" vector="34" mode="ipi"/>
						</event>
					</group>
				</source>
				<target>
					<event physical="linux_keyboard_forward" logical="read_keyboard_data" vector="49"/>
					<event physical="resume_linux" logical="resume_after_trap" vector="none"/>
				</target>
			</events>
			<channels>
				<reader ref="virtual_time" virtualAddress="16#2000#"/>
				<reader ref="linux_keyboard" virtualAddress="16#3000#"/>
				<writer ref="linux_console" virtualAddress="16#4000#"/>
			</channels>
			<binary filename="bzImage" size="16#0050_0000#" virtualAddress="16#0040_0000#"/>
		</subject>
	</subjects>

	<scheduling tickRate="10000">
		<majorFrame>
			<cpu id="0">
				<minorFrame subject="vt" ticks="60"/>
				<minorFrame subject="vt" ticks="60"/>
			</cpu>
			<cpu id="1">
				<minorFrame subject="linux" ticks="120"/>
			</cpu>
			<cpu id="2">
				<minorFrame subject="time" ticks="120"/>
			</cpu>
			<cpu id="3">
				<minorFrame subject="tau0" ticks="120"/>
			</cpu>
		</majorFrame>
		<majorFrame>
			<cpu id="0">
				<minorFrame subject="vt" ticks="120"/>
			</cpu>
			<cpu id="1">
				<minorFrame subject="linux" ticks="120"/>
			</cpu>
			<cpu id="2">
				<minorFrame subject="time" ticks="120"/>
			</cpu>
			<cpu id="3">
				<minorFrame subject="tau0" ticks="120"/>
			</cpu>
		</majorFrame>
	</scheduling>
</system>
